<html>

<head>
<meta http-equiv="Content-Language" content="no-bok">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="keywords" content="Spectravideo MSX SV-318 SV-328 SV-728 SV-738 SV-838">
<meta name="description" content="Spectravideo Documents">
<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>Spectravideo Documents</title>
</head>

<body text="#C0C0C0" bgcolor="#666666" topmargin="18" link="#FFFFFF" vlink="#FFFFFF" alink="#FFFFFF" bgproperties="fixed" background="images/tile.gif">
<div align="center">
  <center>
  &nbsp;
  <table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="665" id="AutoNumber1">
    <tr>
      <td width="100%" bgcolor="#333333">
		<p align="left">
		<map name="FPMap0">
		<area target="_top" href="spectravideo.htm" shape="rect" coords="5, 122, 63, 142">
		<area target="_top" href="svhistory.htm" shape="rect" coords="66, 123, 150, 142">
		<area target="_top" href="sv318.htm" shape="rect" coords="155, 122, 261, 141">
		<area target="_top" href="svsoftware.htm" shape="rect" coords="266, 123, 367, 141">
		<area target="_top" href="svdocuments.htm" shape="rect" coords="371, 124, 482, 142">
		<area target="_top" href="svmisc.htm" shape="rect" coords="487, 123, 540, 141">
		<area target="_top" href="svlinks.htm" shape="rect" coords="543, 123, 601, 140">
		</map>
		<img border="0" src="images/svi/svheader3fl.jpg" width="949" height="168" usemap="#FPMap0"><font face="Arial">&nbsp; 
		<br>
		<br>
		</font>
		<font face="Arial" color="#FFFFFF" size="4"><strong>Memory Banks</strong></font></p>
		<p align="left"><small><font face="Arial">In this section I 
		will describe the SVI-328 memory banks, but this also goes for an 
		expanded SVI-318.<br>
		<br>
		The microprocessor that's in the SVI-328 is the Zilog Z80, that 
		microprocessor can only address 64KB. Sometimes 64KB isn't enough, 
		that's why you can switch memory banks in and out. There are 8 banks 
		devided into 32KB each in the SV-328. Here is a description of the 
		banks:</font></small></p>
		<table width="100%" border="0" id="table1">
			<tr>
				<td width="11%" bgColor="#808080">
				<font face="Arial" color="#000000"><small>FFFFH<br>
				<br>
				8000H</small></font></td>
				<td vAlign="center" align="middle" width="23%" bgColor="#c0c0c0">
				<small><font face="Arial" color="#000000">BANK<br>
				02<br>
				RAM</font></small></td>
				<td vAlign="center" align="middle" width="22%" bgColor="#c0c0c0">
				<small><font face="Arial" color="#000000">BANK<br>
				12<br>
				CARTRIDGE ROM</font></small></td>
				<td vAlign="center" align="middle" width="22%" bgColor="#c0c0c0">
				<small><font face="Arial" color="#000000">BANK<br>
				22<br>
				RAM</font></small></td>
				<td vAlign="center" align="middle" width="22%" bgColor="#c0c0c0">
				<small><font face="Arial" color="#000000">BANK<br>
				32<br>
				RAM</font></small></td>
			</tr>
			<tr>
				<td vAlign="top" width="11%" bgColor="#808080">
				<font face="Arial" color="#000000"><small>7FFFH<br>
				<br>
				0000H</small></font></td>
				<td vAlign="center" align="middle" width="23%" bgColor="#c0c0c0">
				<small><font face="Arial" color="#000000">BANK<br>
				01<br>
				BASIC ROM</font></small></td>
				<td vAlign="center" align="middle" width="22%" bgColor="#c0c0c0">
				<small><font face="Arial" color="#000000">BANK<br>
				11<br>
				CARTRIDGE ROM</font></small></td>
				<td vAlign="center" align="middle" width="22%" bgColor="#c0c0c0">
				<small><font face="Arial" color="#000000">BANK<br>
				21<br>
				RAM</font></small></td>
				<td vAlign="center" align="middle" width="22%" bgColor="#c0c0c0">
				<small><font face="Arial" color="#000000">BANK<br>
				31<br>
				RAM</font></small></td>
			</tr>
		</table>
		<p align="left">&nbsp;</p>
		<table width="100%" border="0" id="table2">
			<tr>
				<td width="11%" bgColor="#808080">
				<font face="Arial" color="#ffffff"><small>Bank No</small></font></td>
				<td width="89%" bgColor="#808080">
				<font face="Arial" color="#ffffff"><small>Description</small></font></td>
			</tr>
			<tr>
				<td width="11%" bgColor="#c0c0c0">
				<font face="Arial" color="#000000"><small>01</small></font></td>
				<td width="89%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">ROM with Microsoft 
				Extended Basic</font></small></td>
			</tr>
			<tr>
				<td width="11%" bgColor="#c0c0c0">
				<font face="Arial" color="#000000"><small>02</small></font></td>
				<td width="89%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">RAM wich is 
				standard in a SV-328. This bank is used for your Basic programs 
				and System variabels, approx. 29KB is free when you have started 
				your computer.</font></small></td>
			</tr>
			<tr>
				<td width="11%" bgColor="#c0c0c0">
				<font face="Arial" color="#000000"><small>11</small></font></td>
				<td width="89%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">ROM space for 
				cartridges. There's nothing here until you insert an cartridge 
				wich uses this space.</font></small></td>
			</tr>
			<tr>
				<td width="11%" bgColor="#c0c0c0">
				<font face="Arial" color="#000000"><small>12</small></font></td>
				<td width="89%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">ROM same as bank 11</font></small></td>
			</tr>
			<tr>
				<td width="11%" bgColor="#c0c0c0">
				<font face="Arial" color="#000000"><small>21</small></font></td>
				<td width="89%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">RAM wich is 
				standard in SV-328.</font></small></td>
			</tr>
			<tr>
				<td width="11%" bgColor="#c0c0c0">
				<font face="Arial" color="#000000"><small>22</small></font></td>
				<td width="89%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">RAM space for 
				expansion with a SV-807</font></small></td>
			</tr>
			<tr>
				<td width="11%" bgColor="#c0c0c0">
				<font face="Arial" color="#000000"><small>31</small></font></td>
				<td width="89%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">RAM space for 
				expansion with a SV-807</font></small></td>
			</tr>
			<tr>
				<td width="11%" bgColor="#c0c0c0">
				<font face="Arial" color="#000000"><small>32</small></font></td>
				<td width="89%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">RAM space for 
				expansion with a SV-807 (intended for use with CP/M v3.0)</font></small></td>
			</tr>
		</table>
		<p><small><font face="Arial">The switching of memory banks is 
		done with the sound chip (AY-3-8910). There are two 8 bit I/O ports in 
		the sound chip (port A and B). This has nothing to do with the 
		production of sound, it's just an extra feature.<br>
		<br>
		Register R7 is a multifunction /ENABLE register wich controls three 
		Noise/Tone mixers and the two general purpose I/O ports directions. The 
		direction (input or output) of the two general purpose I/O ports is 
		determined by the state of bits B7 (port B) and B6 (port A) of R7.<br>
		<br>
		Port A is used for input, so bit 6 should be set to 0.<br>
		Port B is used for output, so bit 7 should be set to 1.<br>
		<br>
		Read or writing data to port A or B is done the same way a register is 
		accessed in the PSG. The register values for the ports are:<br>
		<br>
		Port A = register 14<br>
		Port B = register 15<br>
		<br>
		The memory bank switching is connected to port B, as below:</font></small></p>
		<table width="100%" border="0" id="table3">
			<tr>
				<td align="middle" width="5%" bgColor="#808080">
				<font face="Arial" color="#ffffff"><small>Bit</small></font></td>
				<td width="95%" bgColor="#808080">
				<font face="Arial" color="#ffffff"><small>Description</small></font></td>
			</tr>
			<tr>
				<td align="middle" width="5%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">0</font></small></td>
				<td width="95%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">ROM Cartridge</font></small></td>
			</tr>
			<tr>
				<td align="middle" width="5%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">1</font></small></td>
				<td width="95%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">RAM Bank 21</font></small></td>
			</tr>
			<tr>
				<td align="middle" width="5%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">2</font></small></td>
				<td width="95%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">RAM Bank 22</font></small></td>
			</tr>
			<tr>
				<td align="middle" width="5%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">3</font></small></td>
				<td width="95%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">RAM Bank 31</font></small></td>
			</tr>
			<tr>
				<td align="middle" width="5%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">4</font></small></td>
				<td width="95%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">RAM Bank 32</font></small></td>
			</tr>
			<tr>
				<td align="middle" width="5%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">5</font></small></td>
				<td width="95%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">Caps Lock LED 
				on/off?</font></small></td>
			</tr>
			<tr>
				<td align="middle" width="5%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">6</font></small></td>
				<td width="95%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">ROMEN0?</font></small></td>
			</tr>
			<tr>
				<td align="middle" width="5%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">7</font></small></td>
				<td width="95%" bgColor="#c0c0c0"><small>
				<font face="Arial" color="#000000">ROMEN1?</font></small></td>
			</tr>
		</table>
		<p>&nbsp;</p>
		<h2><small><font size="4" face="Arial" color="#FFFFFF">Sample source</font></small></h2>
		<h4><small><font face="Arial">Setting the correct Input/Output 
		of Port A and B</font></small></h4>
		<pre><font face="Arial">; Sample - Set Port A and B I/O
latch	EQU	88H
write	EQU	8CH
psgreg	EQU	07H

	LD	A,psgreg
	OUT	(latch)		;select PSG register 7
	LD	A,$BF		;Port A (in), Port B(out)
	OUT	(write),A
</font></pre>
		<h4><small><font face="Arial">Switching Bank 31 in/out:</font></small></h4>
		<pre><font face="Arial">; Sample - bank 31 switch program
latch	EQU 	88H
write	EQU 	8CH
read	EQU 	90H
portb	EQU	0FH

	LD	A,portb
	OUT	(latch), A	; select PSG register 15 (Port B)
	IN	A,(read)	; read current value
	XOR	00000010B	; xor bit for bank 31
	OUT	(write),A	; switch bank
</font></pre>
		<h4><small><font face="Arial">Detecting a cartridge in Bank 
		11:</font></small></h4>
		<pre><font face="Arial">; Sample - cartridge (bank 11) test program
latch	EQU 	88H
write	EQU 	8CH
read	EQU 	90H
portb	EQU	15

	LD	A,portb
	OUT	(latch), A	; select PSG register 15 (Port B)
	IN	A,(read)	; read current value
	LD	C,A		; store value
	AND	11111110B	; bank 11
	OUT	(write),A	; switch

	LD	HL,(0)		; address 0 into HL
	LD	A,L
	CP	F3		; is the first byte F3H?
	JR	NZ,exit
	LD	A,H
	CP	31		; is the second byte 31H?
	JP	Z,0		; yes, jump to the start address

exit	LD	A,C		; restore value
	OUT	(write),A	; switch back
	RET
</font></pre>
		<p align="left">
		<font face="Arial" size="2">Source: Tomas Karlsson</font><font face="Arial"><br>
		<br>
&nbsp;</font></p></td>
    </tr>
    <tr>
      <td width="100%" bgcolor="#333333">
      &nbsp;</td>
    </tr>
    <tr>
      <td width="100%" bgcolor="#333333">
      <table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="AutoNumber2">
        <tr>
          <td width="50%"><font face="Tahoma" size="2">Webmaster:
          <img border="0" src="images/roger.gif" width="117" height="14" align="middle"></font><img border="0" src="images/4x4.gif" width="4" height="4"></td>
          <td width="50%">
          <p align="right">&nbsp;</td>
        </tr>
      </table>
      </td>
    </tr>
  </table>
  </center>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>

</body>

</html>